@@copilotGeneratedAction: 'False'
Scripting.RunJavascript.RunJavascript JavascriptCode: $'''var string1 = \'%Filter%\';

WScript.echo(string1.charAt(0).toUpperCase() + string1.slice(1).toLowerCase());''' ScriptOutput=> treatedFilter
SET preContent TO $'''<h2 style=\"font-family: \'Roboto\', sans-serif;\">%Title%: %treatedFilter%</h2>
<table style=\"border-collapse: collapse; font-family: \'Roboto\', sans-serif;\">
    <thead>
            <tr>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Pedido</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Emissão</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Sit</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Descrição Tipo Documento</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Nome Pessoa</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Cidade</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">UF</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Nome Vendedor</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Prev Entrega</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Última Etapa</th>
            <th style=\"font-size: 13px; padding: 8px; text-align: center; font-weight: 700; color: white; background-color: #165bc9;\">Etapa Atual</th>
        </tr>
    </thead>
    <tbody>'''
SET mailContent TO $'''<span style=\"display:none\"><span>'''
SET posContent TO $'''    </tbody>
</table>
'''
SET parCheck TO 1
LOOP FOREACH currentRow IN ExcelData
    Text.SplitText.SplitWithDelimiter Text: currentRow CustomDelimiter: $''',''' IsRegEx: False Result=> arrayItens
    IF Contains(arrayItens[9], Filter, True) THEN
        IF parCheck = 1 THEN
            Text.AppendLine Text: mailContent LineToAppend: $'''<tr>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[0]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[1]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[2]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[3]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[4]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[5]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[6]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[7]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[8]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[9]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[10]%</td>
        </tr>''' Result=> mailContent
            Variables.IncreaseVariable Value: parCheck IncrementValue: 1
        ELSE IF parCheck = 2 THEN
            Text.AppendLine Text: mailContent LineToAppend: $'''<tr style=\"background-color: #eee;\">
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[0]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[1]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[2]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[3]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[4]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[5]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[6]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[7]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[8]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[9]%</td>
            <td style=\"font-size: 13px; padding: 8px; text-align: center; border-bottom: 1px solid #cecece;\">%arrayItens[10]%</td>
        </tr>''' Result=> mailContent
            Variables.DecreaseVariable Value: parCheck DecrementValue: 1
        END
    END
END
IF mailContent.Length <= 33 THEN
    SET errorMail TO $'''<html>
<body style=\"margin: 0; padding: 40px 0 0 0;\">
    <table align=\"center\" border=\"0\" cellpadding=\"0\" cellspacing=\"0\" width=\"600\" style=\"border-collapse: collapse;\">
        <tr>
            <td align=\"center\">
                <img src=\"https://raw.githubusercontent.com/dan1el074/dan1el074/main/outros/metaro-industria-e-comercio-ltda/header-email.jpeg\"
                    alt=\"metaro-banner\" width=\"600\" height=\"80\" style=\"display: block;\">
            </td>
        </tr>
        <tr>
            <td
                style=\"padding:23px 0 40px 0;color:#555;font-size:16px;text-align:justify;font-family:Arial,\'Helvetica Neue\',Helvetica,sans-serif;\">
                <p style=\"padding:0 0 10px 0;\">
                    Olá, tudo bem?
                </p>
                <p style=\"padding:0 0 10px 0;\">
                    Esse e-mail é gerado de forma automática através de uma automação que manda relatórios todos os
                    dias, e como não tivemos nenhuma ocorrencia hoje, o
                    <b>%Title%</b>, com o filtro \"%Filter%\", ficaria vazio.
                </p>
                <p style=\"padding:0 0 10px 0;\">
                    Caso tenha alguma dúvida, entre em contato pelo número <span style=\"color: #0068a5;\">(54)
                        98445-6851</span> ou pelo e-mail <span style=\"color: #0068a5;\">ti@metaro.com.br</span> para
                    falar com o administrador.
                </p>
            </td>
        </tr>
    </table>
</body>
</html>'''
    Email.SendEmail.AuthenticateAndSend SMTPServer: $'''smtps.uhserver.com''' Port: 465 EnableSSL: True Username: $'''automate@metaro.com.br''' Password: P'AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdZWSAWZL/UmFKDcPWjLC6gQAAAACAAAAAAADZgAAwAAAABAAAAAsGDDZA/LuYvk4PAn+EnxXAAAAAASAAACgAAAAEAAAAKyt2vKXpAbw8BYPcc53nUYYAAAAHaMXWc5BUHGdmgEPHhvl0mO56LVmsyC+FAAAAPSM+o3JUMRiOR1VoamDDSHyGMCG' AcceptUntrustedCertificates: False SendFrom: $'''automate@metaro.com.br''' SenderDisplayName: $'''Metaro''' SendTo: emails Subject: $'''Automação Pedido de Vendas''' Body: errorMail IsBodyHtml: True
    EXIT FUNCTION
END
Email.SendEmail.AuthenticateAndSend SMTPServer: $'''smtps.uhserver.com''' Port: 465 EnableSSL: True Username: $'''automate@metaro.com.br''' Password: P'AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAdZWSAWZL/UmFKDcPWjLC6gQAAAACAAAAAAADZgAAwAAAABAAAAAsGDDZA/LuYvk4PAn+EnxXAAAAAASAAACgAAAAEAAAAKyt2vKXpAbw8BYPcc53nUYYAAAAHaMXWc5BUHGdmgEPHhvl0mO56LVmsyC+FAAAAPSM+o3JUMRiOR1VoamDDSHyGMCG' AcceptUntrustedCertificates: False SendFrom: $'''automate@metaro.com.br''' SenderDisplayName: $'''Metaro''' SendTo: emails Subject: $'''Automação Pedido de Vendas''' Body: $'''%preContent%
%mailContent%
%posContent%''' IsBodyHtml: True
